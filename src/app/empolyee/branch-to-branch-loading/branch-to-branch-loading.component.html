<app-header></app-header> 
<div class="container mt-5 pt-5 pb-5">
    <h5 class="text-center fw-bold text-danger mt-3"><u>Parcel Branch To Branch Loading</u></h5>
    <div class="border rounded p-4" style="margin-top: 3rem;">
        <form [formGroup]="form">
            <div class="row mb-3">
                <div class="col-md-3">
                    <label class="form-label form-after ">From Booking Date</label>
                    <input type="date" class="form-control" formControlName="fromBookingDate">
                </div>
                <div class="col-md-3">
                    <label class="form-label form-after">To Booking Date</label>
                    <input type="date" class="form-control" formControlName="toBookingDate">
                </div>
                <div class="col-md-3">
                    <label class="form-label form-after"  >From Branch</label>
                    <input type="text" class="form-control" [value]="pdata.name" style="background-color: #EEEEEE; border: 1px solid #ced4da;" readonly>
                    <input type="text" hidden   class="form-control" [ngModel]="pdata.branchUniqueId" formControlName="fromBranch" readonly>


                </div>           
                <div class="col-md-3 d-flex align-items-end">
                  <button type="button" class="btn w-100" style="background-color: #034F92; color: white;" (click)="loaddata()">Load</button>
                </div>
                
            </div>
        </form>
     

            <!-- <div class="table-responsive mt-4" *ngIf="data">
                <table class="table table-bordered table-striped">
                  <thead>
                    <tr>
                      <th> <input  type="checkbox" (change)="onSelectAllChange($event)" [checked]="allSelected" /> Select All </th>
                      <th>S.No</th>
                      <th>LR No</th>
                      <th>Book by Branch</th>
                      <th>Drop Branch</th>
                      <th>Sender</th>
                      <th>Receiver</th>
                      <th>City Name</th>
                      <th>Transaction Date</th>
                      <th>Paid Type</th>
                      <th>Qty</th>
                      <th>Charge</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let row of data; let i=index">
                      <td> <input type="checkbox" (change)="onGrnNoChange($event, row.grnNo)" [checked]="form1.get('grnNo')?.value.includes(row.grnNo)"/>  </td>
                      
                    <td>{{ i+1 }}</td>
                      <td>{{ row.lrNumber }}</td>
                      <td>{{ row.pickUpBranchname }}</td>
                      <td>{{ row.dropBranchname}}</td>
                      <td>{{ row.senderName }} <br><small>{{row.senderMobile}}</small></td>
                      <td>{{ row.receiverName }} <br><small>{{row.receiverMobile}}</small></td>
                      <td>{{ row.toCity }}</td>
                      <td>{{ row.bookingDate | date:'dd/MM/yyyy' }}</td>
                      <td> {{row.bookingType}} </td>
                      <td> {{row.totalQuantity}} </td>
                      <td>{{ row.grandTotal }}</td>
                    </tr>
                  </tbody>
                </table>
              </div> -->

              <div class="table-responsive mt-4" *ngIf="data && data.length > 0">
                <table class="table table-bordered table-striped">
                  <thead>
                    <tr>
                      <th>
                        <input
                          type="checkbox"
                          (change)="onSelectAllChange($event)"
                          [checked]="allSelected"
                        />
                        Select All
                      </th>
                      <th>S.No</th>
                      <th>LR No</th>
                      <th>Book by Branch</th>
                      <th>Drop Branch</th>
                      <th>Sender</th>
                      <th>Receiver</th>
                      <th>City Name</th>
                      <th>Transaction Date</th>
                      <th>Paid Type</th>
                      <th>Qty</th>
                      <th>Charge</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let row of data; let i = index">
                      <td>
                        <input
                          type="checkbox"
                          (change)="onGrnNoChange($event, row.grnNo)"
                          [checked]="form1.get('grnNo')?.value.includes(row.grnNo)"
                        />
                      </td>
                      <td>{{ i + 1 }}</td>
                      <td>{{ row.lrNumber }}</td>
                      <td>{{ row.pickUpBranchname }}</td>
                      <td>{{ row.dropBranchname }}</td>
                      <td>
                        {{ row.senderName }}<br />
                        <small>{{ row.senderMobile }}</small>
                      </td>
                      <td>
                        {{ row.receiverName }}<br />
                        <small>{{ row.receiverMobile }}</small>
                      </td>
                      <td>{{ row.toCity }}</td>
                      <td>{{ row.bookingDate | date: 'dd/MM/yyyy' }}</td>
                      <td>{{ row.bookingType }}</td>
                      <td>{{ row.totalQuantity }}</td>
                      <td>{{ row.grandTotal }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              

            <form [formGroup]="form1">
                <div class="row">
               
                    <div class="col-md-3">
                      <label class="form-label form-after">Vehicle No</label>
                      <select #vehicle class="form-select form-select-sm mb-3" formControlName="vehicalNumber" aria-label="Large select example">
                        <option value="" selected>Select Vehicle Number</option>
                        <option *ngFor="let vehicle of vdata" [value]="vehicle.vehicleNo">{{ vehicle.vehicleNo }}</option>
                      </select>
                    </div>
                    
                    <div class="col-md-3">
                        <label class="form-label form-after">To Branch</label>
                        <select #toBranch class="form-select" formControlName="toBranch">
                          <option value="" selected>Select Branch</option>
                          <option *ngFor="let branch of ddata" [value]="branch.branchUniqueId">
                            {{ branch.name }}
                          </option>
                        </select>
                      </div>
                      
                    
                    <div class="col-md-6">
                        <label class="form-label">Remark</label>
                        <input type="text" class="form-control" formControlName="remarks">
                    </div>
    
                    <div class="col-md-3 d-flex align-items-end">
                        <button type="button" class="btn  w-100" style="background-color: #034F92; color: white;" (click)="ParcelLoad()">Submit</button>
                    </div>

                </div>

            </form>
            
        </div>

</div>



  <div #printParcelTable class="table-responsive mt-4" *ngIf="parcelResponse">
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>S.No</th>
          <th>GRN No</th>
          <th>LR No</th>
          <th>From City</th>
          <th>Drop City</th>
          <th>Sender Name</th>
          <th>Driver Name</th>
          <th>Driver No</th>
          <th>Vehicle Number</th>
          <th>Voucher No</th>
          <th>Loading Date</th>
          <th>Booking Status</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of mappedParcelData; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ row.grnNo }}</td>
          <td>{{ row.lrNumber }}</td>
          <td>{{ row.fromCity }}</td>
          <td>{{ row.toCity }}</td>
          <td>{{ row.senderName }}</td>
          <td>{{ row.driverName }}</td>
          <td>{{ row.driverNo }}</td>
          <td>{{ row.vehicalNumber }}</td>
          <td>{{ row.vocherNoUnique }}</td>
          <td>{{ row.loadingDate | date: 'dd-MM-yyyy, h:mm a' }}</td>
          <td>
            <ng-container [ngSwitch]="row.bookingStatus">
              <ng-container *ngSwitchCase="'0'">
                <i class="fa fa-times-circle mb-2 text-danger" title="Pending"></i> Booking
              </ng-container>
              <ng-container *ngSwitchCase="'1'">
                <i class="fa fa-check-circle mb-2 text-success" title="Package Load"></i> Loading
              </ng-container>
              <ng-container *ngSwitchCase="'2'">
                <i class="fa fa-check-circle mb-2 text-primary" title="Package OnLoad"></i> Unloading
              </ng-container>
              <ng-container *ngSwitchCase="'3'">
                <i class="fa fa-check-circle mb-2 text-warning" title="Received Branch"></i> Missing
              </ng-container>
              <ng-container *ngSwitchCase="'4'">
                <i class="fa fa-check-circle mb-2 text-success" title="Delivered"></i> Delivery
              </ng-container>
              <ng-container *ngSwitchCase="'5'">
                <i class="pi pi-times-circle mb-2 text-danger" title="Cancelled"></i> Cancel
              </ng-container>
              <ng-container *ngSwitchDefault>
                <span class="text-muted">N/A</span>
              </ng-container>
            </ng-container>
          </td>
        </tr>
        
      </tbody>
    </table>
  </div>




